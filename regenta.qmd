---
title: "<b>La Regenta</b><br>Análisis de la novela en R"
---

```{r setup, include=FALSE}

load("../textos/Tres_sombreros_de_copa.RData")

load("../textos/Regenta.RData")

library(quanteda)

# conviequanteda# convierte en un documento corpus
cp <- corpus(regc, text_field = "texto")

# define los capítulos como nombre
# de los documentos
docnames(cp) <- regc$capitulo


dic <- dictionary(
  list(
    familia=c("padre", "madre", "hijo", "hija", "hermano", "hermana"),
    sociedad=c("vetustense","señor","puebl","ciudad","conversa","amig","visit"),
    iglesia=c("cura","obispo","sacerdo","confesión","religi","canónig","capilla","basilica","cabildo","diócesis","obispado","sacrist","confes","monaguillo","Panteón","trascoro"),
    economia=c("dinero","deuda","negoci","trabaj","fortuna","rico","rica"),
    sentimientos=c("culpa","alegr","amor","remordimiento","ridículo","vergüenza","triste"),
    misticismo=c("Fermín de Pas","magistral","espirit","dios"),
    adulterio=c("Álvaro Mesía","Presidente del Casino", "marido", "placer", "pasión", "amante","amorío"),
    espacio=c("casino","catedral","vivero","casa","espolón","teatro","Encimada"),
    tiempo=c("otoño","verano","invierno","primavera","semana santa","navidad")
  )
)

```

## Introducción

El R permite diferentes tipos de análisis de textos.

Dos tipos de texto. De un lado, una novela. De otro, una obra de teatro. Abren la posibilidad de comparar los resultados de los análisis de textos literarios.

## Análisis de la novela "La Regenta"

Abrimos los datos

```{r}

# carga los datos de "La Regenta"
load("../textos/Regenta.RData")

```

Hacemos un análisis sumario de los capítulos

```{r}


# carga el paquete quanteda para 
# algunos análisis
library(quanteda)

# convierte en un documento corpus
cp <- corpus(regc, text_field = "texto")

# define los capítulos como nombre
# de los documentos
docnames(cp) <- regc$capitulo

# muestra estadísticas básicas de
# cada capítulo
summary(cp)

```

Hacemos un análisis de frecuencia de palabras

```{r}

# convierte en una matriz de términos
dtm <- dfm(tokens(cp, remove_punct = TRUE, 
                  remove_numbers = TRUE, 
                  remove_symbols = TRUE), 
           tolower = TRUE)

dtm <- dfm_remove(dtm, c(stopwords("es"),"si"))

# muestra las 50 palabras más frecuentes
topfeatures(dtm, 50)

```

diccionario

```{r, warning=F, message=F, error=F}

dic <- dictionary(
  list(
    familia=c("padre", "madre", "hijo", "hija", "hermano", "hermana"),
    sociedad=c("vetustense","puebl","ciudad","conversa","amig"),
    iglesia=c("cura","obispo","sacerdo","confesión","religi","canónig","capilla"),
    economia=c("dinero","deuda","negoci","trabaj","fortuna","rico","rica"),
    sentimientos=c("culpa","alegr","amor","remordimiento","ridículo","vergüenza","triste"),
    misticismo=c("Fermín de Pas","Fermín","\\bde Pas\\b", "magistral", "espirit","dios"),
    adulterio=c("Álvaro Mesía","Álvaro","Mesía","Presidente del Casino", "marido", "placer", "pasión", "amante","amorío"),
    espacio=c("casino","catedral","vivero","casa","espolón","teatro"),
    tiempo=c("otoño","verano","invierno","primavera","semana santa","navidad")
  )
)
    
library(tenet)
    
tagCorpus(cp, dic, reshape.to = "sentence")

    

```

```{r, warning=F, message=F, error=F, fig.width=10, fig.height=8}

dicf <- dictionary(
  list(
    familia=c("padre", "madre", "hijo", "hija", "hermano", "hermana"),
    sociedad=c("vetustense","puebl","ciudad","conversa",
               "amig","noble","arist")
))


plotLexDiv(cp, dicf, title ="La Regenta", subtitle = "Familia y sociedad en la novela", palette = pal$cat.awtools.spalette.6[1:2])

```


Repetimos el mismo gráfico, ahora con las categorías de tiempo y espacio:

```{r, warning=F, message=F, error=F, fig.width=10, fig.height=8}

dicf <- dictionary(
  list(
    espacio=c("casino","catedral","vivero","casa","espolón","teatro"),
    tiempo=c("otoño","verano","invierno","primavera","semana santa","navidad")
))

plotLexDiv(cp, dicf, title ="La Regenta", subtitle = "Espacio y tiempo en la novela", palette = pal$cat.brewer.Dark2.8[c(1:4)])


dicf <- dictionary(
  list(
    social=c("casino","teatro"),
    religioso=c("catedral","capilla","sacristía",
                "claustro","seminario"),
    hogar=c("vivero","casa","hogar","alcoba","habitación"),
    paseos=c("espolón","Paseo de Verano","Paseo de los curas")
))



plotLexDiv(cp, dicf, title ="La Regenta", subtitle = "Tipos de espacio.", palette = pal$cat.brewer.Dark2.8[c(1:4)], hline.width = 2)

```





```{r, warning=F, message=F, error=F}

xy <- countKeywords(cp, 
                    dic, 
                    rel.freq = F, 
                    quietly = TRUE)

# Elimina los términos no encontrados
xy <- xy[xy$frequency>0,]

xy$groups <- NULL

forceDirectedTree(xy,value_col = "frequency",
                  palette = pal$cat.awtools.bpalette.16, 
                  max.radius = 50, 
                  height = 500)

```

lo mismo se puede ver así:

```{r, warning=F, message=F, error=F}


plotVoronoiTree(data = xy,
                value_col = "frequency")

```

dd

Juan Benito Argüelles - Nomina de personajes de "La Regenta"

https://cvc.cervantes.es/literatura/cuadernos_del_norte/pdf/23/23_10.pdf


```{r, warning=F, message=F, error=F}


dich <- dictionary(
  list(
    hombres=
      list(
           Alvaro=c("Álvaro Mesía",
                    "Álvaro",
                    "Mesía",
                    "presidente del casino"),
           Saturnino=c("Saturnino Bermúdez",
                       "Saturnino",
                       "Bermúdez",
                       "Saturno",
                       "Saturnillo"),
           Fermin=c("Magistral",
                    "Provisor",
                    "Fermín",
                    "De Pas",
                    "Fermín de Pas",
                    "Magistral"),
           Victor=c("Víctor",
                    "Víctor Quintanar",
                    "Quintanar"),
           Otros=c(
                   "Agustinito",
                   "Amadeo",
                   "Anacleto",
                   "Anselmo",
                   "Antero",
                   "Antón Raíces",
                   "Antonio",
                   "Barcaza",
                   "Basilio",
                   "Bautista",
                   "Bedoya",
                   "Belisario",
                   "Benítez",
                   "Bismark",
                   "Campillo","\\b[C]hato\\b",
                   "don Carlos",
                   "Peláez",
                   "Cayetano","Cayetano Ripamilán","Ripamilán",
                   "Celedonio",
                   "Colás",
                   "marqués de Corujedo",
                   "Frígilis","Crespo",
                   "Custodio",
                   "Olías de Cuervo","señor Cuervo",
                   "Diego",
                   "Escosura",
                   "\\b[E]studiante\\b","Pepe","Trabuco",
                   "Foja",
                   "Fortunato",
                   "Francisco de Asís",
                   "Francisco de Pas",
                   "Francisco de Osuna",
                   "Francisco Páez", "señor Páez", "señor de Páez",
                   "Francisco Carraspique",
                   "Froilán",
                   "don Frutos","Frutos Redondo",
                   "Fulgosio",
                   "Germán",
                   "Glocester","Restituto",
                   "señor Infanzón", "el Infanzón",
                   "Iriarte",
                   "Joaquinito",
                   "Juanito",
                   "Leando",
                   "Maroto",
                   "marqués de Vegallana","\\s{1}[M]arqués\\b",
                   "Martínez",
                   "Matías",
                   "Matiella",
                   "monaguillo",
                   "señor Orgaz",
                   "\\b[P]alma\\b",
                   "Paco","Paquito",
                   "Palomo","Rodríguez",
                   "Parcerisa",
                   "Pedro",
                   "\\b[P]erales\\b",
                   "Pinón",
                   "Pompeyo","Pompeyo Guimarán","Guimarán",
                   "Robustiano",
                   "señor Roque",
                   "Rosendo",
                   "don Santos",
                   "Sousa",
                   "Trifón",
                   "\\b[V]inagre\\b",
                   "Vinculete")
           ),
    mujeres=
      list(
        Ana=c("Ana",
              "Anita",
              "Regenta"),
        Obdulia=c("Obdulia",
                  "Obdulia Fandiño",
                  "Fandiño",
                  "Obdulita"),
        Otras=c(
                "Agapita",
                "Águeda",
                "Angelina",
                "Anuncita",
                "doña Anuncia",
                "Camila",
                "Carolina","Señora de Infanzón", "la Infanzón",
                "Celestina",
                "Edelmira",
                "Emma",
                "Fabiolita",
                "Fulgencia",
                "Gertrudis",
                "la González",
                "Juana",
                "Lola",
                "doña Lucía",
                "marquesa","Rufina",
                "Olvido",
                "doña Paula",
                "Pepa",
                "Guimarán, Perpétua",
                "\\b[P]ilar\\b",
                "Petra",
                "doña Petronila",
                "Ramona",
                "\\bRita\\b",
                "\\bRosa\\b",
                "Rosita",
                "Rudesinda",
                "Servanda",
                "Társila",
                "\\b[T]eresa\\b",
                "Teresina",
                "Úrsula",
                "Visitación",
                "\\b[V]isita\\b",
                "viuda del marqués de Corujedo")
    )
  )
)




xp <- countKeywords(cp, 
                    dich, 
                    rel.freq = F, 
                    group.var = "capitulo",
                    quietly = TRUE)

# Agrega los resultados por los dos niveles
# de código del diccionario
xx <- aggregate(list(frequency=xp$frequency), 
                by=list(groups=xp$groups, 
                        level1=xp$level2), 
                sum, na.rm=T)

# Elimina los términos no encontrados
# en el corpus
xx <- xx[xx$frequency>0,]

# Ordena por capítulo
xx <- xx[order(xx$groups),]

plotSankey(xx, 
           from = "level1", 
           to="groups", 
           value = "frequency", 
           opacity = 0.05)
 


```

dddd

```{r, warning=F, message=F, error=F}

# Reorganiza el corpus según
# sentencias o frases
cs <- corpus_reshape(cp, "sentences")

# Calcula la frecuencia en la
# que dos codigos del mismo 
# diccionario aparecen juntos
# en cada frase
d1 <- matchCodes(cs, 
                dic, 
                level = 1, 
                quietly=TRUE)

# Ordena los resultados de mayor a menor
d1 <- d1[order(d1$value, decreasing = T),]


plotChord(d1, 
          from = "term1", 
          to ="term2", 
          value= "value")

```

Ahora con los personajes

```{r, warning=F, message=F, error=F}

# Reorganiza el corpus según
# sentencias o frases
cs <- corpus_reshape(cp, "sentences")

# Calcula la frecuencia en la
# que dos codigos del mismo 
# diccionario aparecen juntos
# en cada frase
d1 <- matchCodes(cs, 
                dich, 
                level = 2, 
                quietly=TRUE)

# Ordena los resultados de mayor a menor
d1 <- d1[order(d1$value, decreasing = T),]


plotChord(d1, 
          from = "term1", 
          to ="term2", 
          value= "value", elementId = "chord2")

```

aaa
